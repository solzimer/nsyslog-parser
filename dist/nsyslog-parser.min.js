/*! nsyslog-parser-2 2021-11-24 */

"use strict";!function s(l,n,o){function c(i,e){if(!n[i]){if(!l[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(d)return d(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var r=n[i]={exports:{}};l[i][0].call(r.exports,function(e){return c(l[i][1][e]||e)},r,r.exports,s,l,n,o)}return n[i].exports}for(var d="function"==typeof require&&require,e=0;e<o.length;e++)c(o[e]);return c}({1:[function(e,i,t){var a,r;a=window,r=e("./parser.js"),a.NSyslog=a.NSyslog||{},a.NSyslog.parse=r},{"./parser.js":4}],2:[function(e,i,t){var l=["version","deviceVendor","deviceProduct","deviceVersion","deviceEventClassID","name","severity","extension"];i.exports={parse:function(e){var i=function(e){var t=[],a={},i=!1,r=7,s="";return e.split("").forEach(function(e){r?"|"==e?i?(i=!1,s+=e):(t.push(s),s="",r--):"\\"!=e||i?(i=!1,s+=e):i=!0:s+=e}),s.length&&t.push(s),l.forEach(function(e,i){return a[e]=t[i]}),a}(e);return{headers:i,fields:function(e){var i={},t=!1,a="",r="",s="";return e.split("").forEach(function(e){"="==e?t?(t=!1,s+=e,r+=e):(a&&(i[a]=s.slice(0,s.length-r.length-1)),a=r,r=s=""):"\\"!=e||t?" "==e?(t=!1,s+=e,r=""):"n"==e&&t?(t=!1,s+="\n"):"r"==e&&t?(t=!1,s+="\n"):(t=!1,s+=e,r+=e):t=!0}),a&&s&&(i[a]=s),i}(i.extension||"")}}}},{}],3:[function(e,i,t){i.exports={isValidTimeZone:function(e){if(!Intl||!Intl.DateTimeFormat().resolvedOptions().timeZone)throw new Error("Time zones are not available in this environment");try{return Intl.DateTimeFormat(void 0,{timeZone:e}),!0}catch(e){return!1}}}},{}],4:[function(e,i,t){var T=e("./pri.js"),j=e("./cef.js"),I=e("./isValidTimeZone.js").isValidTimeZone,F={pri:/^<\d+>/,prinmr:/^\d+ /,prival:/<(\d+)>/,month:/^[A-Za-z]{3} /,day:/^\d{1,2}/,time:/^\d+:\d+:\d+ /,ts:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\S+ /,invalid:/[^a-zA-Z0-9\.\$\-_#%\/\[\]\(\)]/,sdata:/\[(\S+)( [^\=]+\=\"[^\"]*\")+\]/g,asdata:/^\s*[^\[]+\[/,bsdata:/^\s*\[/,cef:/^CEF:\d+/},C={cef:!0,fields:!0,pid:!0,generateTimestamp:!0};function L(e){do{var i=e.shift();if(void 0===i)return i;i=i.trim()}while(!i);return i}function O(e){var i=!0,t=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var l=r.value.trim();if(l)return l}}catch(e){t=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(t)throw a}}}function S(e,i){if(e.host)if(e.appName)if(e.pid){if(e.messageid)return!!e.structuredData||(e.structuredData=i.trim(),!1);e.messageid=i.trim()}else e.pid=i.trim();else e.appName=i.trim();else e.host=i.trim()}i.exports=function(e,i){try{return function(e,i){i=i?Object.assign({},C,i):C;var t=e.match(F.pri),s={originalMessage:e};if(t){s.pri=t[0],s.prival=parseInt(s.pri.match(F.prival)[1]);var a=T.get(s.prival);s.facilityval=a.facility,s.levelval=a.level,s.facility=T.FACILITY[a.facility].id,s.level=T.LEVEL[a.level].id}else s.pri="",s.prival=null;for(var r=e.substring(s.pri.length).split(" "),l=!1;e.length&&!l;){var n=L(r)+" ",o=O(r);if(n.match(F.prinmr))s.version=parseInt(n),s.type="RFC5424",(n=L(r)+" ").match(F.ts)&&(s.ts=new Date(Date.parse(n.match(F.ts)[0].trim())));else if(n.match(F.month)&&o&&o.match(F.day)){s.type="BSD";var c=n.trim(),d=L(r),u=L(r),f=(new Date).getYear()+1900,m="";4!==u.length||Number.isNaN(+u)||(f=+u,u=L(r)),I(r[0].trim())&&(m=L(r)),s.ts=new Date(Date.parse("".concat(f," ").concat(c," ").concat(d," ").concat(u," ").concat(m).trim()))}else s.type="UNKNOWN",r.unshift(n.trim());l=!0}if(!s.ts&&i.generateTimestamp&&(s.ts=new Date),s.type){var p=function(e){r.unshift(e),s.message=r.join(" "),l=!0};for(l=!1;e.length&&!l;)if(n=L(r))if(n.endsWith(":")){var g=n.replace(/:$/,"").trim();g.match(F.invalid)?p(n):(S(s,g),s.message=r.join(" "),l=!0)}else if(r.length)if(n.match(F.invalid))p(n);else{var h=S(s,n.replace(/: $/,"").trim());!0===h?(r.unshift(n),s.message=r.join(" "),l=!0):!1===h&&(s.message=r.join(" "),l=!0)}else p(n);else l=!0}else s.message=r.join(" ");if(s.chain=(s.host||"").split("/"),s.host=s.chain.pop(),"RFC5424"==s.type){var y=F.bsdata.test(s.message),v=F.asdata.test(s.message),b=s.message.match(F.sdata)||[],N=0;if(s.structuredData=b.map(function(e){var a={},r=null;return N=s.message.indexOf(e)+e.length+1,e.replace(/(^\[)|(\]$)/g,"").split(" ").forEach(function(e,i){if(e.trim())if(0==i)a.$id=e;else{var t=e.split("=");t[0]&&t[1]&&'"'!=t[1]?(r=t.shift(),a[r]=t.join("=").replace(/\"/g,"")):t[0]&&void 0===t[1]?a[r]+=" "+(t[0]||"").replace(/\"/g,""):!t[0]||t[1].length&&'"'!=t[1]||(a[r]+=" "+(t[0]||"").replace(/\"/g,"")+"=")}}),a}),s.structuredData.length){var E=s.message.indexOf("[");y?(0<=E&&(s.header=e.substring(0,e.length-s.message.length)),s.message=s.message.substring(N)):v&&0<=E&&(s.header=e.substring(0,e.length-s.message.length),s.message=s.message.substring(0,E))}}if(!1!==i.cef&&F.cef.test(s.message)){s.type="CEF";var x=j.parse(s.message);s.cef=x.headers,s.fields=x.fields}else if(!1!==i.fields&&"UNKNOWN"!=s.type){var w=[];s.message.split(",").forEach(function(e){var i=e.split("=");2==i.length&&(w[i[0]]=i[1])}),s.fields=w}if(s.header=s.header||e.substring(0,e.length-s.message.length),s.message=s.message.trim(),i.pid&&s.appName&&s.appName.endsWith("]")){var D=s.appName.indexOf("[");0<=D&&(s.pid=s.appName.substring(D+1,s.appName.length-1),s.appName=s.appName.substring(0,D))}return s}(e,i)}catch(e){return{err:e}}}},{"./cef.js":2,"./isValidTimeZone.js":3,"./pri.js":5}],5:[function(e,i,t){var a=[{id:"kern",label:"kernel messages"},{id:"user",label:"user-level messages"},{id:"mail",label:"mail system"},{id:"daemon",label:"system daemons"},{id:"auth",label:"security/authorization messages"},{id:"syslog",label:"messages generated internally by syslogd"},{id:"lpr",label:"line printer subsystem"},{id:"news",label:"network news subsystem"},{id:"uucp",label:"UUCP subsystem"},{id:"cron",label:"clock daemon"},{id:"authpriv",label:"security/authorization messages"},{id:"ftp",label:"FTP daemon"},{id:"ntp",label:"NTP subsystem"},{id:"security",label:"log audit"},{id:"console",label:"log alert"},{id:"solaris-cron",label:"clock daemon"},{id:"local0",label:"locally used facility 0"},{id:"local1",label:"locally used facility 0"},{id:"local2",label:"locally used facility 0"},{id:"local3",label:"locally used facility 0"},{id:"local4",label:"locally used facility 0"},{id:"local5",label:"locally used facility 0"},{id:"local6",label:"locally used facility 0"},{id:"local7",label:"locally used facility 0"}],r=[{id:"emerg",label:"system is unusable"},{id:"alert",label:"action must be taken immediately"},{id:"crit",label:"critical conditions"},{id:"error",label:"error conditions"},{id:"warn",label:"warning conditions"},{id:"notice",label:"normal but significant condition"},{id:"info",label:"informational messages"},{id:"debug",label:"debug-level messages"}],s=[],l=[];a.forEach(function(e,i){return s[e.id]=i}),r.forEach(function(e,i){return l[e.id]=i}),i.exports.LEVEL=r,i.exports.FACILITY=a,i.exports.LEVELS=l,i.exports.FACILITIES=s,i.exports.get=function(e,i){return"number"==typeof e&&void 0===i?{level:7&e,facility:e>>3}:"number"==typeof e&&"number"==typeof i?8*e+i:"string"==typeof e&&"number"==typeof i?8*(s[e]||0)+i:"number"==typeof e&&"string"==typeof i?8*e+(l[i]||0):"string"==typeof e&&"string"==typeof i?8*(s[e]||0)+(l[i]||0):{level:0,facility:0}}},{}]},{},[1]);